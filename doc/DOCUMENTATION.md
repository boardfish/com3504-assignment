<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Like][1]
    -   [insert][2]
        -   [Parameters][3]
-   [Story][4]
    -   [insert][5]
        -   [Parameters][6]
    -   [getStory][7]
        -   [Parameters][8]
    -   [findUserById][9]
        -   [Parameters][10]
    -   [getAllStories][11]
        -   [Parameters][12]
-   [User][13]
    -   [insert][14]
        -   [Parameters][15]
    -   [pre][16]
    -   [passwordIsCorrect][17]
        -   [Parameters][18]
-   [Utils][19]
    -   [render][20]
        -   [Parameters][21]
    -   [renderError][22]
        -   [Parameters][23]
    -   [renderHtml][24]
        -   [Parameters][25]
    -   [renderJson][26]
        -   [Parameters][27]
-   [Seeder][28]
    -   [findStoryById][29]
        -   [Parameters][30]

## Like

The Like model represents a rating on a story. It has a story and a rating
from 0 to 4. This is represented as 1-5 in the frontend.

### insert

This controller action creates a new Like object linked to the story with the
ID specified by the storyId parameter on the request. A vote from 1 to 5
inclusive should also be supplied.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object

## Story

The Story model represents a post on the site. It has an author (user), text
content, and associated ratings (likes).

### insert

This controller action creates a new story against the currently
authenticated user.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object

### getStory

This controller action retrieves just one story by its ID, including the
accompanying user and rating data. If HTML is requested, note that a full
view is not returned - only the HTML data for the story div is returned, such
that it should be appended to the page using jQuery.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object

### findUserById

Finds a user by their ID. In the event of an error (particularly defending
against CastError here), null is returned. This is a wrapper for
User.findById that handles invalid IDs (albeit heavy-handedly).

#### Parameters

-   `userId` **[string][33]** the ID of a user in the database

Returns **[Object][34]** a user, or null if no user exists with that ID

### getAllStories

This controller action retrieves either all stories on the site or, if the
parameter userId is specified on the request, one user's stories (i.e. their
wall). If the user could not be found, a 404 error response is returned.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object

## User

The user model represents an account for a user of the site. They have a
username, nickname, email address and password. The username and password are
used to log in to the site.

### insert

This controller action creates a new user with the supplied JSON data. A
username, password, email and nickname should be supplied.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object

### pre

Before saving the user, their password must be hashed for security.

### passwordIsCorrect

This function checks that a given password matches the one that the user
originally set. It is used in Passport login events to verify inputs.

#### Parameters

-   `passwordInput` **[string][33]** the password input to compare with the user's
-   `callback` **[function][35]** a callback function

Returns **[function][35]** callback

## Utils

Wrapper functions to make it easier to render HTML and JSON in the right
circumstances with the right data across the app.

### render

Wrapper function for rendering pages. If it's passed an error, it'll render
it appropriately by delegating to renderError. Otherwise, it'll render JSON
if Content-Type is set to application/json, or it'll render HTML.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object
-   `viewName` **[string][33]** the name of the view for the templating engine to render
-   `status` **[number][36]** a status code to return in the event of an (expected) error
-   `err` **[error][37]** an error
-   `jsonData` **[Object][34]** the data to return if JSON was asked for
-   `htmlData` **[Object][34]** data to pass to the templating engine in rendering HTML
-   `titleAppend` **[string][33]** a string to append to the page title

### renderError

Renderer for errors. Errors are displayed in a similar style to the rest of
the app.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object
-   `status` **[number][36]** a status code to return in the event of an (expected) error
-   `err` **[error][37]** an error

### renderHtml

This function wraps Express' res.render function, ensuring that it always
supplies several variables to the templating engine that are necessary for
every page.

#### Parameters

-   `req` **[Request][31]** a Request object
-   `res` **[Response][32]** a Response object
-   `viewName` **[string][33]** the name of the view for the templating engine to render
-   `err` **[error][37]** an error
-   `data` **[Object][34]** data to pass to the templating engine
-   `titleAppend` **[string][33]** an optional string to append to the page title

### renderJson

This function simply wraps Express' res.send function, but it's named as such
to make this file's render function more readable.

#### Parameters

-   `res` **[Response][32]** a Response object
-   `err` **[error][37]** an error
-   `data` **[Object][34]** data to render to a JSON response

## Seeder

Seeds data from usersStoriesAndRatings.json.

### findStoryById

Takes a story's text and returns the first matching ID.

#### Parameters

-   `id` **[string][33]** the id of a story in the JSON file

Returns **[Object][34]** the JSON object from the stories array in that file, with
its storyId equal to id.

[1]: #like

[2]: #insert

[3]: #parameters

[4]: #story

[5]: #insert-1

[6]: #parameters-1

[7]: #getstory

[8]: #parameters-2

[9]: #finduserbyid

[10]: #parameters-3

[11]: #getallstories

[12]: #parameters-4

[13]: #user

[14]: #insert-2

[15]: #parameters-5

[16]: #pre

[17]: #passwordiscorrect

[18]: #parameters-6

[19]: #utils

[20]: #render

[21]: #parameters-7

[22]: #rendererror

[23]: #parameters-8

[24]: #renderhtml

[25]: #parameters-9

[26]: #renderjson

[27]: #parameters-10

[28]: #seeder

[29]: #findstorybyid

[30]: #parameters-11

[31]: https://developer.mozilla.org/Add-ons/SDK/High-Level_APIs/request

[32]: https://developer.mozilla.org/docs/Web/Guide/HTML/HTML5

[33]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[34]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[35]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[36]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[37]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error
